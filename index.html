<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Resume Analyzer & Job Matcher</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    
    <style>
        /* --- 1. Root Variables & Theme Switching (Purple/Green Scheme) --- */
        :root {
            --bg-color: #ffffff;
            --text-color: #333333;
            --card-bg: #f8f9fa;
            --accent-color: #1d36a2; /* light blue accent */
            --secondary-color: #34c039; /* Green for success */
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
            --border-radius: 10px;
            /* NEW: Particle color for Light Mode */
            --particle-color: rgb(44 103 180 / 26%); 
        }
        [data-theme="dark"] {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --card-bg: #1e1e1e;
            --shadow: 0 4px 15px rgba(0,0,0,0.4);
            /* NEW: Particle color for Dark Mode */
            --particle-color: rgb(44 103 180 / 26%);
}
        
        /* --- 2. Global Resets and Body --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
            min-height: 100vh;
            line-height: 1.6;
        }
        .nav-container { 
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 2fr 1fr; 
            gap: 30px;
            align-items: start;
            transition: grid-template-columns 0.4s ease; /* Smooth transition for grid change */
        }
        .card {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }
        h2 {
            color: var(--accent-color);
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
        }
        h2 i {
            margin-right: 10px;
        }
        
        /* --- 3. Navbar and Authentication Links --- */
        .top-nav {
            background-color: var(--card-bg);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .nav-content {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--accent-color);
        }
        .auth-links {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .nav-btn {
            text-decoration: none;
            color: var(--text-color);
            padding: 8px 15px;
            border-radius: 6px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .nav-btn:hover {
            background-color: rgba(156,39,176,0.1); 
        }
        /* General Primary Button Style */
        .primary-btn {
            background: var(--accent-color);
            color: white !important;
            box-shadow: 0 4px 8px rgba(156,39,176,0.3);
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 60px;
        }
        .primary-btn:hover {
            background: var(--secondary-color);
            box-shadow: 0 6px 10px rgba(76,175,80,0.4);
            transform: translateY(-1px);
        }
        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 1.2em;
            cursor: pointer;
            margin-left: 10px;
            transition: color 0.3s ease;
        }
        .theme-toggle:hover {
            color: var(--accent-color);
        }

        /* Profile Dropdown Specific Styles */
        #nav-user {
            position: relative;
        }
        #profile-dropdown {
            display: none;
            position: absolute;
            top: 45px;
            right: 0;
            background: var(--card-bg);
            box-shadow: var(--shadow);
            border-radius: 8px;
            padding: 10px;
            z-index: 1000;
            min-width: 140px;
            border: 1px solid rgba(0,0,0,0.1);
        }
        [data-theme="dark"] #profile-dropdown {
            border: 1px solid rgba(255,255,255,0.1);
        }
        #profile-dropdown a {
            text-decoration: none;
            color: var(--danger-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        #profile-dropdown a:hover {
            background: rgba(244, 67, 54, 0.1);
        }
        /* --- Improved Profile Dropdown Look (Same Color Theme) --- */
#profile-dropdown {
    padding: 8px 0;
    animation: fadeInScale 0.2s ease-out;
}

#profile-dropdown a {
    color: var(--text-color);
    font-weight: 500;
    padding: 10px 14px;
    border-radius: 6px;
    transition: all 0.2s ease;
}

#profile-dropdown a i {
    color: var(--accent-color);
    width: 18px;
    text-align: center;
}

#profile-dropdown a:hover {
    background: rgba(62, 143, 214, 0.12); /* accent color soft hover */
    color: var(--accent-color);
}

#profile-dropdown hr {
    border: none;
    border-top: 1px solid rgba(0,0,0,0.1);
    margin: 6px 10px;
}

[data-theme="dark"] #profile-dropdown hr {
    border-top: 1px solid rgba(255,255,255,0.15);
}

@keyframes fadeInScale {
    from { opacity: 0; transform: scale(0.95); }
    to { opacity: 1; transform: scale(1); }
}

        /* --- 4. Hero Section (with Advanced Canvas Background) --- */
        .hero-section {
            position: relative; 
            padding: 80px 0; 
            margin-bottom: 30px;
            border-bottom: 5px solid var(--accent-color);
            overflow: hidden; 
            background: linear-gradient(135deg, var(--bg-color), var(--card-bg));
        }
        #particle-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; 
            opacity: 1; 
        }
        .hero-content {
            position: relative; 
            z-index: 10; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 50px;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .hero-text {
            max-width: 600px;
            text-shadow: 0 1px 5px rgba(0, 0, 0, 0.2); 
        }
        [data-theme="dark"] .hero-text {
            text-shadow: none;
        }
        .hero-text h1 {
            font-size: 3.2em; 
            color: var(--accent-color);
            margin-bottom: 15px;
            line-height: 1.2;
        }
        .hero-text p {
            font-size: 1.3em; 
            color: var(--text-color); 
            opacity: 1;
            margin-bottom: 30px;
        }
        [data-theme="dark"] .hero-text p {
            /* Text clarity fix for dark theme */
            color: #444444; 
        }
        .hero-btn {
            padding: 18px 35px; 
            font-size: 1.2em;
            display: inline-block;
        }
        
        /* Stat Cards */
        .stat-cards {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            max-width: 300px;
        }
        .stat-card {
            background-color: var(--bg-color);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-align: center;
            border-left: 5px solid var(--secondary-color);
            transition: transform 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        .stat-card i {
            font-size: 2em;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }
        .stat-card h4 {
            font-size: 1.5em;
            color: var(--text-color);
            margin: 0;
        }
        .stat-card p {
            font-size: 0.9em;
            opacity: 0.7;
            margin: 0;
        }

        /* --- 5. Main Content (Upload Form & Results) --- */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
            transition: grid-column 0.4s ease;
        }
        
        /* TASK 1/2: Full-Width Results and Sidebar Hiding */
        /* When body has this class, we switch to results view */
        body.results-view .main-content {
            grid-column: 1 / span 2; /* Main content takes full width */
        }
        
        body.results-view .sidebar {
            display: none; /* Sidebar is completely hidden */
        }

        body.results-view .upload-card {
            display: none; /* Hide the form when results are shown */
        }

        /* Hide the loading card in the upload view */
        .loading-card, .results {
            display: none; 
        }


        .upload-card {
            border-top: 5px solid var(--accent-color);
        }
        
        /* Form Inputs Styling */
        .upload-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        .upload-section textarea,
        .upload-section input[type="file"]:not([style*="display: none"]) {
            display: block;
            margin-bottom: 15px;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 100%;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        .upload-section textarea {
            resize: vertical;
            min-height: 120px;
        }
        .upload-section input:focus, 
        .upload-section textarea:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(156,39,176,0.2); 
            outline: none;
        }
        
        /* Analysis Mode Selector Styling */
        .analysis-mode-selector {
            margin-bottom: 25px;
        }
        .toggle-label {
            display: block;
            font-size: 0.9em;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-color);
        }
        .mode-toggle-bar {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 50px;
            padding: 5px;
            display: flex;
            position: relative;
            cursor: pointer;
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
        }
        [data-theme="dark"] .mode-toggle-bar {
            background: rgba(255, 255, 255, 0.1);
        }
        .mode-slider {
            position: absolute;
            height: calc(100% - 10px);
            width: calc(50% - 5px);
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            border-radius: 50px;
            top: 5px;
            left: 5px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1;
        }
        .mode-toggle-bar.quick-active .mode-slider {
            transform: translateX(calc(100% - 5px));
        }
        .mode-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            font-weight: 600;
            font-size: 0.95em;
            z-index: 2;
            transition: color 0.3s ease;
            color: var(--text-color);
        }
        .mode-option.active {
            color: #fff;
        }

        .upload-section button {
            background: linear-gradient(45deg, var(--accent-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(156,39,176,0.3);
            margin-top: 10px;
        }
        .upload-section button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(156,39,176,0.5);
        }
        
        /* 2. IMPROVEMENT: Drag & Drop Zone Styling */
        .drop-zone {
            border: 3px dashed var(--accent-color);
            border-radius: var(--border-radius);
            padding: 40px 30px;
            text-align: center;
            cursor: pointer;
            background-color: var(--bg-color);
            margin-bottom: 20px;
            transition: all 0.2s ease;
        }
        .drop-zone-active {
            background-color: rgba(156, 39, 176, 0.1); 
            border-color: var(--secondary-color);
        }
        .drop-zone p {
            font-size: 1.1em;
            color: var(--text-color);
            margin-bottom: 15px;
            opacity: 0.7;
        }
        .drop-zone i {
            font-size: 2.5em;
            color: var(--accent-color);
            display: block;
            margin-bottom: 15px;
        }
        .file-select-btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: var(--accent-color);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }
        .file-select-btn:hover {
            background-color: var(--secondary-color);
        }

        /* 3. IMPROVEMENT: Loading/Skeletor Styles */
        .loading-card {
            border-top: 5px solid var(--warning-color);
            padding: 30px;
            text-align: left;
        }
        .skeletor-text {
            height: 1.2em;
            background-color: rgba(156, 39, 176, 0.2); 
            border-radius: 4px;
            margin-bottom: 15px;
            width: 90%;
            animation: pulse 1.5s infinite ease-in-out;
        }
        .loading-animation {
            background: linear-gradient(90deg, var(--accent-color), var(--secondary-color));
            background-size: 200% 100%;
            animation: loading-bar 1.5s linear infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 0.8; }
            100% { opacity: 0.5; }
        }

        @keyframes loading-bar {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        [data-theme="dark"] .skeletor-text {
            background-color: rgba(76, 175, 80, 0.2); 
        }
        
        /* --- 6. Results Section --- */
        .results-card {
            border-left: 5px solid var(--secondary-color);
        }
        .score-display {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px dashed rgba(0,0,0,0.1);
            padding-bottom: 20px;
        }
        .score {
            font-size: 4.5em;
            font-weight: 700;
            color: var(--secondary-color);
            margin-bottom: 5px;
        }
        .score-label {
            font-size: 1.3em; 
            color: var(--text-color);
            opacity: 0.9;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 15px;
        }
        [data-theme="dark"] .progress-bar {
            background-color: #2a2a2a;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2661b9, #38bc3d); 
            width: 0%;
            border-radius: 10px;
            transition: width 1s ease;
        }
        
        .skills-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .skill-card {
            background-color: var(--bg-color); 
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .skill-card.missing {
            border-left-color: var(--danger-color);
        }
        .skill-card h3 {
            font-size: 1.2em;
            color: var(--accent-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        .skill-card.missing h3 {
            color: var(--danger-color);
            border-bottom: 2px solid var(--danger-color);
        }
        .skill-card ul {
            list-style: none;
            padding: 0;
        }
        .skill-card li {
            padding: 7px 0;
            font-size: 0.95em;
        }
        .suggestions.card {
            border-left: 4px solid var(--warning-color);
            background-color: var(--card-bg);
        }
        .suggestions h3 {
            color: var(--warning-color);
            border-bottom: 2px solid var(--warning-color);
        }

        /* --- NEW: Professional Batch Table Styles for Quick Scan --- */
        .batch-results-container {
            width: 100%;
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            border: 1px solid rgba(0,0,0,0.1);
        }
        .batch-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
            min-width: 1000px; /* Accommodate more columns */
        }
        .batch-table th {
            background: var(--accent-color);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        .batch-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            color: var(--text-color);
        }
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
            text-transform: uppercase;
        }
        .status-accepted { background: rgba(76, 175, 80, 0.2); color: #2e7d32; }
        .status-rejected { background: rgba(244, 67, 54, 0.2); color: #c62828; }
        
        /* TASK 3: Professional Control Buttons Styling */
        .analysis-controls {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            padding: 0;
            background: none;
            box-shadow: none;
        }
        .analysis-controls button {
            flex-grow: 1;
            padding: 16px 30px; /* Increased padding */
            font-size: 1.2em; /* Increased font size */
            font-weight: 700;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        #save-result-btn {
            background: var(--secondary-color);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }
        #save-result-btn:hover {
            background: #388e3c; /* Darker green on hover */
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6);
        }
        
        #return-btn {
            background: var(--accent-color);
            box-shadow: 0 4px 15px rgba(156, 39, 176, 0.4);
        }
        #return-btn:hover {
            background: #7b1fa2; /* Darker purple on hover */
            transform: scale(1.02);
            box-shadow: 0 6px 20px rgba(156, 39, 176, 0.6);
        }
        .analysis-controls button i {
            margin-right: 10px;
        }


        /* --- 7. Sidebar (Recent Activity/History) --- */
        .sidebar {
            padding: 30px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border-left: 5px solid var(--secondary-color);
            transition: display 0.4s ease;
        }
        .resume-list {
            display: grid;
            gap: 15px;
        }
        .resume-item {
            background-color: var(--bg-color);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .resume-item:hover {
            background-color: rgba(156,39,176,0.05);
        }
        .resume-info h4 {
            margin-bottom: 5px;
            color: var(--accent-color);
            font-size: 1em;
        }
        .resume-score {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--secondary-color);
        }
        /* Footer Centering Fix: */
        .footer {
            text-align: center;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9em;
            margin-top: 50px;
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        /* --- 8. Modals (Login/Signup) --- */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top of overlay */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background-color: var(--card-bg);
            margin: 5% auto;
            padding: 30px;
            border: 1px solid #888;
            width: 90%;
            max-width: 450px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            position: relative;
        }
        .modal-content h2 {
            text-align: center;
            color: var(--accent-color);
            margin-bottom: 30px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 10px;
        }
        .modal-content input[type="text"], 
        .modal-content input[type="password"], 
        .modal-content input[type="email"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        .modal-content button {
            width: 100%;
            padding: 12px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.3s ease;
        }
        .modal-content button:hover {
            background-color: var(--secondary-color);
        }
        .close-btn {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 20px;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .close-btn:hover, .close-btn:focus {
            color: var(--danger-color);
            text-decoration: none;
        }
        /* --- NEW MODAL STYLES FOR SOCIAL LOGIN (Change to Sign Section) --- */
        .separator {
            text-align: center;
            margin: 20px 0;
            position: relative;
            color: #aaa;
        }
        .separator::before,
        .separator::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%;
            height: 1px;
            background-color: #eee;
        }
        [data-theme="dark"] .separator::before,
        [data-theme="dark"] .separator::after {
            background-color: #333;
        }
        .separator::before {
            left: 0;
        }
        .separator::after {
            right: 0;
        }
        .social-btn {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.3s ease;
            font-weight: 600;
        }
        .social-btn:hover {
            opacity: 0.9;
        }
        .social-btn i {
            margin-right: 10px;
            font-size: 1.2em;
        }
        .google-btn {
            background-color: #db4437; /* Google red */
            color: white;
            border: none;
        }
        /* --- END OF NEW MODAL STYLES --- */

        /* --- 9. Responsive Design --- */
        @media (max-width: 992px) {
            .container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .main-content {
                order: 1;
            }
            .sidebar {
                order: 2;
            }
            .nav-content {
                flex-direction: column;
                gap: 10px;
            }
            /* Hero adjustments for small screens */
            .hero-content {
                flex-direction: column;
                text-align: center;
                gap: 30px;
            }
            .hero-text {
                max-width: 100%;
            }
            .hero-text h1 {
                font-size: 2.5em;
            }
            .stat-cards {
                grid-template-columns: 1fr 1fr;
                max-width: 100%;
            }
        }
        @media (max-width: 576px) {
            .stat-cards {
                grid-template-columns: 1fr;
            }
            .analysis-controls {
                flex-direction: column; /* Stack buttons vertically on small screens */
            }
            .analysis-controls button {
                font-size: 1.1em; /* Adjusted size for mobile stacked view */
                padding: 14px;
            }
        }
    </style>
</head>
<body data-theme="light">
    <header class="top-nav">
        <div class="nav-content nav-container">
            <h1 class="logo"><i class="fas fa-brain"></i> AI Matcher</h1>
            <nav class="auth-links">
                <div id="nav-guest" style="display: flex; align-items: center; gap: 15px;">
                    <a href="#" class="nav-btn" id="open-login"><i class="fas fa-sign-in-alt"></i> Log In</a>
                    <a href="#" class="nav-btn primary-btn" id="open-signup"><i class="fas fa-user-plus"></i> Sign Up</a>
                </div>

               <div id="nav-user" style="display: none; align-items: center; gap: 10px;">
    
    <span id="profile-name" style="font-weight: 600; color: var(--text-color);"></span>

    <div id="profile-trigger" style="width: 40px; height: 40px; background: var(--accent-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid var(--secondary-color);">
        <i class="fas fa-user"></i>
    </div>

                    <div id="profile-dropdown">
                        <a href="#" id="dashboard-link" style="color: var(--text-color); font-weight: 500;"><i class="fas fa-chart-pie"></i>Analytics (HR)</a>
    
                         <a href="#" id="user-dashboard-link" style="color: var(--text-color); font-weight: 500;"><i class="fas fa-user-graduate"></i> My Career Path (User)</a>
                        <a href="#" id="settings-link" style="color: var(--text-color); font-weight: 500;"><i class="fas fa-cog"></i> Settings</a>
                        <hr style="border: none; border-top: 1px solid rgba(0,0,0,0.1); margin: 6px 0;">
                         <a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>

                <button class="theme-toggle" id="theme-toggle"><i class="fas fa-moon"></i></button>
            </nav>
        </div>
    </header>

    <main>
        <section class="hero-section">
            <canvas id="particle-canvas"></canvas>
            <div class="hero-content">
                <div class="hero-text">
                    <h1>Match Your Resume to Your Dream Job with AI Precision.</h1>
                    <p>Stop guessing! Our AI analyzes your resume against any job description, providing a score, personalized suggestions, and skill gap analysis in seconds.</p>
                    <a href="#upload-form" class="primary-btn hero-btn" id="hero-analyze-btn"><i class="fas fa-chart-bar"></i> Start Analysis Now</a>
                </div>
                <div class="stat-cards">
                    <div class="stat-card">
                        <i class="fas fa-tachometer-alt"></i>
                        <h4>95%</h4>
                        <p>Average Match Accuracy</p>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-file-alt"></i>
                        <h4>2.5M+</h4>
                        <p>Resumes Analyzed</p>
                    </div>
                </div>
            </div>
        </section>

        <div class="container">
            
            <div class="main-content">
                <form id="submission-form">
                    <div class="card upload-card" id="upload-form" style="position: relative;">
                        
                        <div id="auth-lock-overlay" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); z-index: 20; flex-direction: column; align-items: center; justify-content: center; border-radius: var(--border-radius);">
                            <div style="background: var(--card-bg); padding: 30px; border-radius: 15px; text-align: center; box-shadow: var(--shadow); border: 2px solid var(--accent-color);">
                                <i class="fas fa-lock" style="font-size: 3rem; color: var(--accent-color); margin-bottom: 15px;"></i>
                                <h3 style="margin-bottom: 10px;">Feature Locked</h3>
                                <p style="margin-bottom: 20px;">Please Sign Up to use the AI Analysis features.</p>
                                <button type="button" class="primary-btn" id="lock-signup-btn" style="padding: 10px 20px;">Sign Up Now</button>
                            </div>
                        </div>

                        <h2 id="form-title"><i class="fas fa-upload"></i> Analyze Your Profile</h2>
                        
                        <div class="analysis-mode-selector">
                            <span class="toggle-label"><i class="fas fa-bolt"></i> Analysis Precision Mode</span>
                            <div class="mode-toggle-bar" id="mode-toggle-bar">
                                <div class="mode-slider"></div>
                                <div class="mode-option active" id="mode-deep">Deep Scan</div>
                                <div class="mode-option" id="mode-quick">Quick Scan</div>
                            </div>
                        </div>

                        <div class="upload-section">
                            <label for="resume-file" id="resume-label">Resume/CV File:</label>
                            <div class="drop-zone" id="drop-zone">
                                <p id="drop-zone-text"><i class="fas fa-cloud-upload-alt"></i> Drag & Drop your Resume (PDF/DOCX) here, or</p>
                                <label for="resume-file" class="file-select-btn" id="select-btn-label">Browse Resume File</label>
                                <input type="file" id="resume-file" accept=".pdf,.docx" style="display: none;">
                                <div id="file-name-display" style="margin-top: 10px; font-style: italic; opacity: 0.8; display: none;"></div>
                            </div>
                            
                            <label for="job-file">Upload Job Requirements (Optional File):</label>
                            <input type="file" id="job-file" accept=".pdf,.docx,.txt">

                            <label for="job-text">Paste Job Description Text (Required):</label>
                            <textarea id="job-text" placeholder="Paste your job description text here..."></textarea>
                            
                            <button type="button" id="analyze-btn"><i class="fas fa-search"></i> Run AI Analysis</button>
                        </div>
                    </div>
                </form>

                <div class="card loading-card" id="loading-results">
                    <h2><i class="fas fa-cog fa-spin"></i> Analyzing Resume and JD...</h2>
                     <h3 id="progress-text" style="text-align: center; color: var(--accent-color); margin-bottom: 10px; display: none;">Processing: 0 of 0</h3>
                    <div class="skeletor-text"></div>
                    <div class="skeletor-text" style="width: 70%;"></div>
                    <div class="progress-bar" style="margin-top: 25px;">
                        <div class="progress-fill loading-animation" style="width: 100%;"></div>
                    </div>
                    <p style="text-align: center; margin-top: 15px; font-style: italic; opacity: 0.8;">Extracting skills, assessing competency, and calculating compatibility score.</p>
                </div>

                <div class="card results results-card" id="results">
                    <h2><i class="fas fa-chart-line"></i> Analysis Results</h2>
                    <div class="score-display">
                        <div class="score" id="match-score">0%</div>
                        <div class="score-label">Job Match Score</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>

                    <div class="skills-section">
                        <div class="skill-card">
                            <h3><i class="fas fa-check-circle"></i> Matched Skills</h3>
                            <ul id="matched-skills">
                                </ul>
                        </div>
                        <div class="skill-card missing">
                            <h3><i class="fas fa-times-circle"></i> Missing Skills</h3>
                            <ul id="missing-skills">
                                </ul>
                        </div>
                    </div>

                    <div class="suggestions card">
                        <h3><i class="fas fa-lightbulb"></i> AI Suggestions</h3>
                        <ul id="suggestions-list">
                            </ul>
                    </div>
                </div>

                <div class="card results results-card" id="results-batch" style="display:none;">
                    <h2><i class="fas fa-users"></i> HR Batch Analysis Report</h2>
                    <div class="batch-results-container">
                        <table class="batch-table">
                            <thead>
                                <tr>
                                    <th>Candidate Name</th>
                                    <th>Email</th>
                                    <th>Mobile Number</th>
                                    <th>Experience</th>
                                    <th>Stage</th>
                                    <th>Source</th>
                                    <th>Match Score</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="batch-table-body">
                                </tbody>
                        </table>
                    </div>
                </div>

                <div class="analysis-controls" id="analysis-controls" style="display: none;">
                    <button id="save-result-btn" class="primary-btn"><i class="fas fa-save"></i> Save Result</button>
                    <button id="return-btn" class="primary-btn"><i class="fas fa-undo"></i> Return to Main Page</button>
                </div>

            </div>
            
            <div class="sidebar">
                <div class="top-resumes">
                    <h2><i class="fas fa-history"></i> Recent Activity</h2>
                    <div class="resume-list" id="top-resumes-list">
                        <div class="resume-item">
                            <div class="resume-info">
                                <h4>Bilal Ahmad - Software Engineer</h4>
                                <p>2 hours ago</p>
                            </div>
                            <div class="resume-score" style="color: var(--secondary-color);">92%</div>
                        </div>
                        <div class="resume-item">
                            <div class="resume-info">
                                <h4>Hafsa khan - Data Analyst</h4>
                                <p>Yesterday</p>
                            </div>
                            <div class="resume-score" style="color: var(--warning-color);">68%</div>
                        </div>
                        </div>
                </div>
            </div>

        </div>
    <!-- setting page structure  -->
    <div id="settings-view" class="card" style="display: none; max-width: 900px; margin: 40px auto; border-top: 5px solid var(--accent-color); padding: 30px;">
    <div style="margin-bottom: 30px; border-bottom: 1px solid rgba(0,0,0,0.1); padding-bottom: 15px;">
        <h2 style="margin:0;"><i class="fas fa-user-cog"></i> Account Settings</h2>
        <p style="font-size: 0.9rem; opacity: 0.7;">Manage your profile and system preferences</p>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px;">
        <div class="skill-card" style="background: rgba(0,0,0,0.02); padding: 20px; border-radius: 8px;">
            <h3 style="font-size: 1.1rem; margin-bottom:15px;"><i class="fas fa-id-card"></i> Personal Profile</h3>
            <label style="display:block; margin-bottom:8px; font-size:0.9rem; font-weight:600;">Display Name</label>
            <input type="text" id="settings-name" style="width:100%; padding:12px; border-radius:6px; border:1px solid #ccc; background:var(--bg-color); color:var(--text-color); margin-bottom:15px;">
            
            <label style="display:block; margin-bottom:8px; font-size:0.9rem; font-weight:600;">Professional Headline</label>
            <input type="text" id="settings-headline" placeholder="e.g. Software Engineer" style="width:100%; padding:12px; border-radius:6px; border:1px solid #ccc; background:var(--bg-color); color:var(--text-color);">
        </div>

        <div class="skill-card" style="background: rgba(0,0,0,0.02); padding: 20px; border-radius: 8px;">
            <h3 style="font-size: 1.1rem; margin-bottom:15px;"><i class="fas fa-sliders-h"></i> System Preferences</h3>
            <label style="display:block; margin-bottom:8px; font-size:0.9rem; font-weight:600;">Interface Language</label>
            <select id="settings-lang" style="width:100%; padding:10px; border-radius:6px; border:1px solid #ccc; background:var(--bg-color); color:var(--text-color); margin-bottom:15px;">
                <option value="en">English (US)</option>
                <option value="fr">French</option>
                <option value="de">German</option>
            </select>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <span>Dark Mode Architecture</span>
                <input type="checkbox" id="settings-theme-toggle">
            </div>
        </div>

        <div class="skill-card" style="background: rgba(0,0,0,0.02); padding: 20px; border-radius: 8px;">
            <h3 style="font-size: 1.1rem; margin-bottom:15px;"><i class="fas fa-user-shield"></i> Privacy</h3>
            <button id="clear-history-btn" style="width:100%; padding:10px; background:var(--warning-color); color:white; border:none; border-radius:6px; cursor:pointer; margin-bottom:12px; font-weight:600;">Clear History</button>
            <button id="delete-account-btn" style="width:100%; padding:10px; background:var(--danger-color); color:white; border:none; border-radius:6px; cursor:pointer; font-weight:600;">Delete Account</button>
        </div>
    </div>

    <div style="margin-top:40px; padding-top:20px; border-top: 1px solid rgba(0,0,0,0.1); display:flex; justify-content: flex-end; gap:15px;">
        <button id="close-settings-btn" style="padding:12px 25px; border-radius:60px; border:1px solid #ccc; background:none; color:var(--text-color); cursor:pointer; font-weight:600;"><i class="fas fa-arrow-left"></i> Back</button>
        <button id="save-settings-btn" class="primary-btn" style="padding:12px 35px;"><i class="fas fa-save"></i> Apply Changes</button>
    </div>
</div>
<!-- setting html end-->

 <!-- /////////////// -->

<!-- dashboard html -->
 <div id="dashboard-view" class="card" style="display: none; max-width: 1350px; margin: 20px auto; padding: 25px; border-top: 5px solid var(--accent-color);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <div>
        <h2 style="margin:0;"><i class="fas fa-chart-pie"></i> ATS Analytics Dashboard</h2>
        <p style="font-size: 0.9rem; opacity: 0.7;">Real-time recruitment performance and candidate insights</p>
    </div>
    <div style="display: flex; gap: 10px;">
        <button id="download-report-btn" class="nav-btn" style="background: var(--secondary-color); color: white; border-radius: 20px; padding: 8px 20px; border: none;">
            <i class="fas fa-file-download"></i> Download PDF Report
        </button>
        
        <button id="back-from-dash" class="nav-btn" style="border: 1px solid var(--accent-color); border-radius: 20px; padding: 8px 20px;">
            <i class="fas fa-arrow-left"></i> Back to Home
        </button>
    </div>
</div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="stat-card" style="border-left: 5px solid var(--accent-color);">
            <i class="fas fa-users" style="color: var(--accent-color);"></i>
            <h4>1,284</h4>
            <p>Total Applications</p>
        </div>
        <div class="stat-card" style="border-left: 5px solid var(--secondary-color);">
            <i class="fas fa-user-check" style="color: var(--secondary-color);"></i>
            <h4>156</h4>
            <p>Shortlisted</p>
        </div>
        <div class="stat-card" style="border-left: 5px solid var(--warning-color);">
            <i class="fas fa-clock" style="color: var(--warning-color);"></i>
            <h4>42</h4>
            <p>Pending Review</p>
        </div>
        <div class="stat-card" style="border-left: 5px solid var(--danger-color);">
            <i class="fas fa-user-times" style="color: var(--danger-color);"></i>
            <h4>842</h4>
            <p>Rejected</p>
        </div>
    </div>
    <div class="skill-card" style="margin-top: 25px;">
    <h3><i class="fas fa-stream"></i> Active Hiring Pipeline</h3>
    <div style="display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px;">
        <div style="min-width: 250px; background: rgba(0,0,0,0.03); padding: 10px; border-radius: 8px;">
            <p style="font-weight: bold; margin-bottom: 10px;">New Applied (12)</p>
            <div class="stat-card" style="font-size: 0.8rem; padding: 10px; margin-bottom: 5px; border-left: 3px solid var(--accent-color);">
                Zaid Mansoor <span style="float:right">98%</span>
            </div>
            <div class="stat-card" style="font-size: 0.8rem; padding: 10px; border-left: 3px solid var(--accent-color);">
                Sara Ali <span style="float:right">94%</span>
            </div>
           
        </div>
        <div style="min-width: 250px; background: rgba(0,0,0,0.03); padding: 10px; border-radius: 8px;">
            <p style="font-weight: bold; margin-bottom: 10px;">Deep Scanning (5)</p>
            <div style="text-align: center; color: var(--accent-color); padding: 20px;">
                <i class="fas fa-sync fa-spin"></i> Processing...
            </div>
        </div>
        <div style="min-width: 250px; background: rgba(0,0,0,0.03); padding: 10px; border-radius: 8px;">
            <p style="font-weight: bold; margin-bottom: 10px;">Interview (3)</p>
            <div class="stat-card" style="font-size: 0.8rem; padding: 10px; border-left: 3px solid var(--secondary-color);">
                Hamza Khan <span style="float:right">89%</span>
            </div>
             <div class="stat-card" style="font-size: 0.8rem; padding: 10px; border-left: 3px solid var(--secondary-color);">
                Hafsa Khan <span style="float:right">89%</span>
            </div>
        </div>
    </div>
</div>
<!-- /// -->
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 25px; margin-bottom: 30px;">
        <div class="skill-card">
            <h3><i class="fas fa-chart-bar"></i> Hiring Pipeline Trend</h3>
            <div style="height: 250px; display: flex; align-items: flex-end; justify-content: space-around; padding-top: 20px; border-bottom: 2px solid #ddd;">
                <div style="width: 40px; height: 40%; background: var(--accent-color); border-radius: 5px 5px 0 0;" title="Jan: 40"></div>
                <div style="width: 40px; height: 65%; background: var(--accent-color); border-radius: 5px 5px 0 0;" title="Feb: 65"></div>
                <div style="width: 40px; height: 85%; background: var(--secondary-color); border-radius: 5px 5px 0 0;" title="Mar: 85"></div>
                <div style="width: 40px; height: 55%; background: var(--accent-color); border-radius: 5px 5px 0 0;" title="Apr: 55"></div>
                <div style="width: 40px; height: 95%; background: var(--secondary-color); border-radius: 5px 5px 0 0;" title="May: 95"></div>
            </div>
            <div style="display: flex; justify-content: space-around; margin-top: 10px; font-size: 0.8rem; font-weight: bold;">
                <span>Jan</span><span>Feb</span><span>Mar</span><span>Apr</span><span>May</span>
            </div>
        </div>

        <div class="skill-card">
            <h3><i class="fas fa-adjust"></i> Match Accuracy</h3>
            <div style="width: 180px; height: 180px; border-radius: 50%; background: conic-gradient(var(--secondary-color) 0% 75%, var(--warning-color) 75% 90%, var(--danger-color) 90% 100%); margin: 20px auto; position: relative; display: flex; align-items: center; justify-content: center;">
                <div style="width: 120px; height: 120px; background: var(--card-bg); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2rem;">75% High</div>
            </div>
            <ul style="list-style: none; font-size: 0.85rem; padding: 0;">
                <li><i class="fas fa-circle" style="color: var(--secondary-color);"></i> 80%+ Match (75%)</li>
                <li><i class="fas fa-circle" style="color: var(--warning-color);"></i> 50-80% Match (15%)</li>
                <li><i class="fas fa-circle" style="color: var(--danger-color);"></i> Below 50% (10%)</li>
            </ul>
        </div>
    </div>

    <div class="skill-card">
        <h3><i class="fas fa-star"></i> Top Talent Discovery</h3>
        <!--  -->
        <div id="ai-insight-box" style="margin-top: 15px; padding: 15px; background: #eef7ff; border-radius: 8px; border: 1px dashed var(--accent-color);">
    <h4 style="color: var(--accent-color); margin-bottom: 5px;"><i class="fas fa-magic"></i> AI Deep Scan Highlight</h4>
    <p style="font-size: 0.85rem; line-height: 1.4;">
        "Candidate <strong>Zaid Mansoor</strong> shows exceptional growth in <strong>React/Next.js</strong> over 3 years. 
        <span style="color: var(--secondary-color); font-weight: bold;">Recommendation:</span> Move to technical interview. 
        <span style="color: var(--danger-color); font-weight: bold;">Note:</span> Verify Python proficiency manually."
    </p>
</div>
<!--  -->
        <div class="batch-results-container" style="min-width: 100%;">
            <table class="batch-table">
                <thead>
                    <tr>
                        <th>Candidate</th>
                        <th>Applied Role</th>
                        <th>AI Score</th>
                        <th>Experience</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Zaid Mansoor</strong></td>
                        <td>Full Stack Dev</td>
                        <td><span style="color: var(--secondary-color); font-weight: bold;">98%</span></td>
                        <td>4.5 Years</td>
                        <td><button style="padding: 5px 10px; border-radius: 5px; border: none; background: var(--accent-color); color: white; cursor: pointer;">View Profile</button></td>
                    </tr>
                    <tr>
                        <td><strong>Sara Ali</strong></td>
                        <td>UI/UX Designer</td>
                        <td><span style="color: var(--secondary-color); font-weight: bold;">94%</span></td>
                        <td>3 Years</td>
                        <td><button style="padding: 5px 10px; border-radius: 5px; border: none; background: var(--accent-color); color: white; cursor: pointer;">View Profile</button></td>
                    </tr>
                      <tr>
                        <td><strong>Saim Bilal</strong></td>
                        <td>Software developer</td>
                        <td><span style="color: var(--secondary-color); font-weight: bold;">80%</span></td>
                        <td>2 Years</td>
                        <td><button style="padding: 5px 10px; border-radius: 5px; border: none; background: var(--accent-color); color: white; cursor: pointer;">View Profile</button></td>
                    </tr>
                      <tr>
                        <td><strong>Ali Raza</strong></td>
                        <td>Software tester</td>
                        <td><span style="color: var(--secondary-color); font-weight: bold;">78%</span></td>
                        <td>1Years</td>
                        <td><button style="padding: 5px 10px; border-radius: 5px; border: none; background: var(--accent-color); color: white; cursor: pointer;">View Profile</button></td>
                    </tr>
                      <tr>
                        <td><strong>Usman Javaid</strong></td>
                        <td>SEO expert</td>
                        <td><span style="color: var(--secondary-color); font-weight: bold;">90%</span></td>
                        <td>3 Years</td>
                        <td><button style="padding: 5px 10px; border-radius: 5px; border: none; background: var(--accent-color); color: white; cursor: pointer;">View Profile</button></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
 <!-- dashboard html end -->
  <!-- User dashboard html -->
   <div id="user-dashboard-view" class="card" style="display: none; max-width: 1350px; margin: 20px auto; padding: 25px; border-top: 5px solid var(--secondary-color);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <div>
            <h2 style="color: var(--secondary-color);"><i class="fas fa-user-circle"></i> Candidate Success Portal</h2>
            <p style="font-size: 0.9rem; opacity: 0.7;">Improve your profile and track your AI deep scan results</p>
        </div>
        <button onclick="returnToMain()" class="nav-btn" style="border: 1px solid var(--secondary-color); border-radius: 20px; padding: 8px 20px;">
            <i class="fas fa-home"></i> Back to Home
        </button>
    </div>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="stat-card" style="border-left: 5px solid var(--accent-color);">
            <i class="fas fa-file-medical" style="color: var(--accent-color);"></i>
            <h4>82/100</h4>
            <p>Resume Health Score</p>
        </div>
        <div class="stat-card" style="border-left: 5px solid var(--secondary-color);">
            <i class="fas fa-briefcase" style="color: var(--secondary-color);"></i>
            <h4>12</h4>
            <p>Applied Jobs</p>
        </div>
        <div class="stat-card" style="border-left: 10px solid var(--warning-color);">
            <i class="fas fa-medal" style="color: var(--warning-color);"></i>
            <h4>Top 5%</h4>
            <p>Talent Ranking</p>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
        <div class="skill-card">
            <h3><i class="fas fa-bolt" style="color: var(--warning-color);"></i> AI Skill Gap Recommendation</h3>
            <p style="margin-bottom: 15px; font-size: 0.9rem;">To reach a 95% match for <b>Senior Developer</b> roles, add these:</p>
            <div style="background: rgba(0,0,0,0.03); padding: 15px; border-radius: 8px;">
                <div style="margin-bottom: 10px;">
                    <span style="font-size: 0.85rem;">Kubernetes & Docker</span>
                    <div class="progress-bar" style="height: 8px;"><div class="progress-fill" style="width: 30%; background: var(--danger-color);"></div></div>
                </div>
                <div>
                    <span style="font-size: 0.85rem;">Cloud Architecture (AWS)</span>
                    <div class="progress-bar" style="height: 8px;"><div class="progress-fill" style="width: 65%; background: var(--warning-color);"></div></div>
                </div>
            </div>
        </div>

        <div class="skill-card">
            <h3><i class="fas fa-history"></i> Recent Scan Results</h3>
            <div class="resume-item" style="margin-bottom: 10px;">
                <span>Full Stack Resume.pdf</span>
                <span class="status-badge status-accepted">92% Match</span>
            </div>
            <div class="resume-item">
                <span>Data Science CV.docx</span>
                <span class="status-badge status-rejected" style="background: rgba(255,152,0,0.2); color: #e65100;">68% Match</span>
            </div>
        </div>
    </div>
</div>
   <!-- User dashboard html end -->
    </main>
    
    <footer class="footer">
        <div class="nav-container">
            &copy; AI Job Matcher. All rights reserved. | <a href="#" style="color: var(--accent-color); text-decoration: none;">@BR Developer</a>
        </div>
    </footer>


    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" data-modal="login-modal">&times;</span>
            <h2>Login</h2>
            
            <form id="login-form">
                <input type="email" placeholder="Email" required>
                <input type="password" placeholder="Password" required>
                <button type="submit">Log In</button>
            </form>
            
            <div class="separator">OR</div>
            
            <button type="button" class="social-btn google-btn"><i class="fab fa-google"></i> Sign in with Google</button>
            
            <p style="text-align: center; margin-top: 15px;">Don't have an account? <a href="#" id="modal-open-signup" style="color: var(--accent-color); text-decoration: none;">Sign Up</a></p>
        </div>
    </div>

    <div id="signup-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" data-modal="signup-modal">&times;</span>
            <h2>Sign Up</h2>
            
            <form id="signup-form">
                <input type="text" placeholder="Full Name" required>
                <input type="email" placeholder="Email" required>
                <input type="password" placeholder="Password" required>
                <button type="submit">Create Account</button>
            </form>
            
            <div class="separator">OR</div>

            <button type="button" class="social-btn google-btn"><i class="fab fa-google"></i> Sign up with Google</button>
            
            <p style="text-align: center; margin-top: 15px;">Already have an account? <a href="#" id="modal-open-login" style="color: var(--accent-color); text-decoration: none;">Log In</a></p>
        </div>
    </div>


<script>
        document.addEventListener('DOMContentLoaded', (event) => {

            // --- AUTH STATE & ELEMENTS ---
            let isUserLoggedIn = false; // Mock authentication status
            let signedUpUserName = ""; // store name from signup
            const lockOverlay = document.getElementById('auth-lock-overlay');
            const navGuest = document.getElementById('nav-guest');
            const navUser = document.getElementById('nav-user');
            const profileTrigger = document.getElementById('profile-trigger');
            const profileDropdown = document.getElementById('profile-dropdown');
            const logoutBtn = document.getElementById('logout-btn');
            const lockSignupBtn = document.getElementById('lock-signup-btn');
            //////////
            let appliedJobsCount = 0; // Yeh count track karega kitni CVs analyze hui hain

            // --- 0. Setup Elements ---
            const uploadCard = document.querySelector('.upload-card');
            const loadingResults = document.getElementById('loading-results');
            const results = document.getElementById('results');
            const resultsBatch = document.getElementById('results-batch');
            const analyzeBtn = document.getElementById('analyze-btn');
            const heroAnalyzeBtn = document.getElementById('hero-analyze-btn');
            const submissionForm = document.getElementById('submission-form');
            const body = document.body;

            // Mode Toggle Elements
            const modeToggleBar = document.getElementById('mode-toggle-bar');
            const modeDeep = document.getElementById('mode-deep');
            const modeQuick = document.getElementById('mode-quick');
            const formTitle = document.getElementById('form-title');
            const resumeLabel = document.getElementById('resume-label');
            const dropZoneText = document.getElementById('drop-zone-text');
            const selectBtnLabel = document.getElementById('select-btn-label');
            const resumeFile = document.getElementById('resume-file');

            // --- AUTH LOGIC FUNCTIONS ---
            function handleAuthSuccess() {
                isUserLoggedIn = true;
                lockOverlay.style.display = 'none'; // Lock disappears immediately
                navGuest.style.display = 'none';
                navUser.style.display = 'flex';
                loginModal.style.display = 'none';
                signupModal.style.display = 'none';
            }

            // Profile Dropdown Toggle
            profileTrigger.addEventListener('click', () => {
                profileDropdown.style.display = profileDropdown.style.display === 'none' ? 'block' : 'none';
            });

            // Logout Logic
            logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                window.location.reload(); // Refresh the page as requested
            });

            // Trigger Auth Success on mock submissions
           document.getElementById('login-form').addEventListener('submit', (e) => { 
    e.preventDefault(); 

    handleAuthSuccess();

    // Show user name near profile icon
    const profileName = document.getElementById('profile-name');
    if (signedUpUserName && profileName) {
        profileName.textContent = signedUpUserName;
    }

    ////////////////back button user portal logic ////////
const userDashBackBtn = document.querySelector('#user-dashboard-view button.nav-btn');
if (userDashBackBtn) {
    userDashBackBtn.addEventListener('click', (e) => {
        e.preventDefault();
        // User dashboard hide karein
        document.getElementById('user-dashboard-view').style.display = 'none';
        // Hero section aur main container show karein
        document.querySelector('.hero-section').style.display = 'block';
        document.querySelector('.container').style.display = 'grid';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
}
    /////////////end////////////////////
});

            document.getElementById('signup-form').addEventListener('submit', (e) => {
            e.preventDefault();

            // Get name from signup form
            const nameInput = document.querySelector('#signup-form input[type="text"]');
            signedUpUserName = nameInput.value;

           // Close signup modal
           signupModal.style.display = 'none';

         // Open login modal (user must login now)
         loginModal.style.display = 'block';
});

            
            // Link lock button to signup
            lockSignupBtn.addEventListener('click', () => {
                signupModal.style.display = 'block';
            });

            // --- Analysis Mode Switching Logic ---
            modeToggleBar.addEventListener('click', () => {
                modeToggleBar.classList.toggle('quick-active');
                
                if (modeToggleBar.classList.contains('quick-active')) {
                    // HR / ATS Mode (Quick Scan)
                    modeQuick.classList.add('active');
                    modeDeep.classList.remove('active');
                    
                    formTitle.innerHTML = '<i class="fas fa-users-cog"></i> Batch HR Resume Analyzer';
                    resumeLabel.innerText = "Upload Candidate Resumes (Multiple Files):";
                    dropZoneText.innerHTML = '<i class="fas fa-copy"></i> Drag & Drop multiple Resumes (PDF/DOCX) here, or';
                    selectBtnLabel.innerText = "Browse Resumes";
                    resumeFile.setAttribute('multiple', 'multiple');
                } else {
                    // Individual Mode (Deep Scan)
                    modeDeep.classList.add('active');
                    modeQuick.classList.remove('active');
                    
                    formTitle.innerHTML = '<i class="fas fa-upload"></i> Analyze Your Profile';
                    resumeLabel.innerText = "Resume/CV File:";
                    dropZoneText.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> Drag & Drop your Resume (PDF/DOCX) here, or';
                    selectBtnLabel.innerText = "Browse Resume File";
                    resumeFile.removeAttribute('multiple');
                }
                // Reset file display on switch
                updateFileNameDisplay(null);
                submissionForm.reset();
            });

            // --- 1. Theme Toggle Logic ---
            const themeToggle = document.getElementById('theme-toggle');
            const icon = themeToggle ? themeToggle.querySelector('i') : null;
            if (themeToggle && icon) {
                if (!body.dataset.theme) body.dataset.theme = 'light';
                icon.className = body.dataset.theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';

                themeToggle.addEventListener('click', () => {
                    body.dataset.theme = body.dataset.theme === 'dark' ? 'light' : 'dark';
                    icon.className = body.dataset.theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                    // Re-render particles if function exists
                    if (window.animateParticles) {
                        window.animateParticles();
                    }
                });
            }

            // --- 2. Modal Logic (Login & Signup) ---
            const loginModal = document.getElementById('login-modal');
            const signupModal = document.getElementById('signup-modal');
            const openLoginBtn = document.getElementById('open-login');
            const openSignupBtn = document.getElementById('open-signup');
            const closeBtns = document.querySelectorAll('.close-btn');
            const modalOpenLogin = document.getElementById('modal-open-login');
            const modalOpenSignup = document.getElementById('modal-open-signup');

            if (openLoginBtn) openLoginBtn.addEventListener('click', (e) => {
                e.preventDefault();
                loginModal.style.display = 'block';
            });

            if (openSignupBtn) openSignupBtn.addEventListener('click', (e) => {
                e.preventDefault();
                signupModal.style.display = 'block';
            });

            if (modalOpenSignup) modalOpenSignup.addEventListener('click', (e) => {
                e.preventDefault();
                loginModal.style.display = 'none';
                signupModal.style.display = 'block';
            });

            if (modalOpenLogin) modalOpenLogin.addEventListener('click', (e) => {
                e.preventDefault();
                signupModal.style.display = 'none';
                loginModal.style.display = 'block';
            });

            closeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const modalId = btn.getAttribute('data-modal');
                    document.getElementById(modalId).style.display = 'none';
                });
            });

            window.addEventListener('click', (event) => {
                if (event.target == loginModal) loginModal.style.display = 'none';
                if (event.target == signupModal) signupModal.style.display = 'none';
            });

            // --- 3. Analyzer Logic ---
            const matchScore = document.getElementById('match-score');
            const progressFill = document.getElementById('progress-fill');
            const matchedSkills = document.getElementById('matched-skills');
            const missingSkills = document.getElementById('missing-skills');
            const suggestionsList = document.getElementById('suggestions-list');
            const historyList = document.getElementById('top-resumes-list');
            const jobTextarea = document.getElementById('job-text');
            const analysisControls = document.getElementById('analysis-controls');
            const returnBtn = document.getElementById('return-btn');
            const saveBtn = document.getElementById('save-result-btn');
            const loadingCard = document.getElementById('loading-results');
            const resultsDiv = document.getElementById('results');
            const resumeInput = document.getElementById('resume-file');

            const fileNameDisplay = document.getElementById('file-name-display');
            function updateFileNameDisplay(name) {
                if (name) {
                    fileNameDisplay.textContent = name;
                    fileNameDisplay.style.display = 'block';
                } else {
                    fileNameDisplay.textContent = '';
                    fileNameDisplay.style.display = 'none';
                }
            }

            if (heroAnalyzeBtn && uploadCard) {
                heroAnalyzeBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    uploadCard.scrollIntoView({ behavior: 'smooth' });
                });
            }

            // --- 4. Drag & Drop Logic ---
            const dropZone = document.getElementById('drop-zone');
            if (dropZone) {
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, preventDefaults, false);
                });
                ['dragenter', 'dragover'].forEach(eventName => {
                    dropZone.addEventListener(eventName, () => dropZone.classList.add('drop-zone-active'), false);
                });
                ['dragleave', 'drop'].forEach(eventName => {
                    dropZone.addEventListener(eventName, () => dropZone.classList.remove('drop-zone-active'), false);
                });
                dropZone.addEventListener('drop', handleDrop, false);

                function preventDefaults (e) { e.preventDefault(); e.stopPropagation(); }
                function handleDrop(e) {
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        resumeFile.files = files;
                        updateFileNameDisplay(files.length > 1 ? `${files.length} files selected` : files[0].name);
                    }
                }
                resumeFile.addEventListener('change', () => {
                    if (resumeFile.files.length > 0) {
                        updateFileNameDisplay(resumeFile.files.length > 1 ? `${resumeFile.files.length} files selected` : resumeFile.files[0].name);
                    } else {
                        updateFileNameDisplay(null);
                    }
                });
            }

            // --- Updated Analysis Logic to connect to Backend ---
if (analyzeBtn) {
    analyzeBtn.addEventListener('click', async (e) => {
        e.preventDefault();

        if (!isUserLoggedIn) {
            lockOverlay.style.display = 'flex';
            uploadCard.scrollIntoView({ behavior: 'smooth' });
            return;
        }

        const jobText = document.getElementById('job-text').value.trim();
        const resumeFiles = document.getElementById('resume-file').files;
        
        if (resumeFiles.length === 0 || jobText.length < 50) {
            alert("Please upload Resume file(s) and paste a Job Description.");
            return;
        }

        const isBatchMode = modeToggleBar.classList.contains('quick-active');
        
        // UI Setup
        document.body.classList.remove('results-view');
        uploadCard.style.display = 'none';
        loadingResults.style.display = 'block';
        loadingResults.scrollIntoView({ behavior: 'smooth' });

        // Progress elements update
        const progressText = document.getElementById('progress-text');
        const loadingBarFill = document.querySelector('#loading-results .progress-fill');
        
        if (isBatchMode) {
            progressText.style.display = 'block';
            loadingBarFill.classList.remove('loading-animation'); // Auto animation hata kar manual karenge
            loadingBarFill.style.width = '0%';
        } else {
            progressText.style.display = 'none';
            loadingBarFill.classList.add('loading-animation');
        }

        try {
            let finalData = [];

            if (isBatchMode) {
                // --- BATCH MODE WITH PROGRESS COUNTER ---
                const total = resumeFiles.length;
                
                for (let i = 0; i < total; i++) {
                    // Update Counter Text
                    progressText.innerText = `Analyzing Candidate ${i + 1} of ${total}...`;
                    
                    // Progress Bar update
                    let percent = ((i) / total) * 100;
                    loadingBarFill.style.width = percent + '%';

                    const formData = new FormData();
                    formData.append("resume_file", resumeFiles[i]); // Aik aik karke bhej rahe hain
                    formData.append("job_text", jobText);

                    const response = await fetch("http://127.0.0.1:8000/analyze", {
                        method: "POST",
                        body: formData 
                    });

                    if (response.ok) {
                        const result = await response.json();
                        result.status = result.match_score >= 70 ? "Accepted" : "Rejected";
                        finalData.push(result);
                    }
                }
                loadingBarFill.style.width = '100%';
                
                // Show Batch Results
                setTimeout(() => {
                    loadingResults.style.display = 'none';
                    body.classList.add('results-view');
                    resultsBatch.style.display = 'block';
                    analysisControls.style.display = 'flex';
                    
                    const tableBody = document.getElementById('batch-table-body');
                    tableBody.innerHTML = finalData.map(res => `
                        <tr>
                            <td><strong>${res.candidate_name || 'N/A'}</strong></td>
                            <td>${res.email || 'N/A'}</td>
                            <td>${res.phone || 'N/A'}</td>
                            <td>${res.experience || 'N/A'}</td>
                            <td>Screening</td>
                            <td>Web Upload</td>
                            <td><span style="font-weight:800; color:${res.match_score >= 70 ? 'var(--secondary-color)' : 'var(--danger-color)'}">${res.match_score}%</span></td>
                            <td><span class="status-badge ${res.match_score >= 70 ? 'status-accepted' : 'status-rejected'}">${res.status}</span></td>
                        </tr>
                    `).join('');
                }, 500);

            } else {
                // --- SINGLE DEEP SCAN ---
                const formData = new FormData();
                formData.append("resume_file", resumeFiles[0]);
                formData.append("job_text", jobText);

                const response = await fetch("http://127.0.0.1:8000/analyze", {
                    method: "POST",
                    body: formData 
                });

                const data = await response.json(); 
                loadingResults.style.display = 'none';
                body.classList.add('results-view');
                analysisControls.style.display = 'flex';
                results.style.display = 'block';

                matchScore.textContent = (data.match_score || 0) + '%';
                progressFill.style.width = (data.match_score || 0) + '%';
                matchedSkills.innerHTML = (data.matched_skills || []).map(s => `<li><i class="fas fa-check"></i> ${s}</li>`).join('');
                missingSkills.innerHTML = (data.missing_skills || []).map(s => `<li><i class="fas fa-times"></i> ${s}</li>`).join('');
                suggestionsList.innerHTML = (data.suggestions || []).map(s => `<li><i class="fas fa-lightbulb"></i> ${s}</li>`).join('');

                updateUserDashboard(data, resumeFiles[0].name);
                updateHistory(resumeFiles[0].name, data.match_score);
            }

        } catch (error) {
            console.error("Error:", error);
            alert("Analysis failed.");
            loadingResults.style.display = 'none';
            uploadCard.style.display = 'block';
        }
    });
    // analyzeBtn.addEventListener('click', async (e) => {
    //     e.preventDefault();

    //     if (!isUserLoggedIn) {
    //         lockOverlay.style.display = 'flex';
    //         uploadCard.scrollIntoView({ behavior: 'smooth' });
    //         return;
    //     }

    //     const jobText = document.getElementById('job-text').value.trim();
    //     const resumeInput = document.getElementById('resume-file');
    //     const resumeFiles = resumeInput.files;
        
    //     if (resumeFiles.length === 0 || jobText.length < 50) {
    //         alert("Please upload Resume file(s) and paste a Job Description.");
    //         return;
    //     }

    //     // Yeh detect karega ke toggle button kis mode par hai
    //     const isBatchMode = modeToggleBar.classList.contains('quick-active');
    //     const endpoint = isBatchMode ? "/analyze-batch" : "/analyze";

    //     // UI Reset aur Loading Show karna
    //     document.body.classList.remove('results-view');
    //     uploadCard.style.display = 'none';
    //     loadingResults.style.display = 'block';
    //     loadingResults.scrollIntoView({ behavior: 'smooth' });

    //     const formData = new FormData();
    //     formData.append("job_text", jobText);

    //     if (isBatchMode) {
    //         // HR Mode: Multiple files append kar rahe hain
    //         for (let i = 0; i < resumeFiles.length; i++) {
    //             formData.append("resume_files", resumeFiles[i]);
    //         }
    //     } else {
    //         // Deep Scan: Sirf pehli file bhej rahe hain
    //         formData.append("resume_file", resumeFiles[0]);
    //     }

    //     try {
    //         const response = await fetch(`http://127.0.0.1:8000${endpoint}`, {
    //             method: "POST",
    //             body: formData 
    //         });

    //         if (!response.ok) throw new Error("Server connection error");

    //         const data = await response.json(); 
    //         loadingResults.style.display = 'none';
    //         body.classList.add('results-view');
    //         analysisControls.style.display = 'flex';

    //         if (isBatchMode) {
    //             // --- QUICK SCAN (HR BATCH) UI ---
    //             results.style.display = 'none'; // Individual detail card hide karein
    //             resultsBatch.style.display = 'block'; // Table show karein
                
    //             const tableBody = document.getElementById('batch-table-body');
    //             // Table mein AI se extracted data fill karna
    //             tableBody.innerHTML = data.map(res => `
    //                 <tr>
    //                     <td><strong>${res.candidate_name || 'N/A'}</strong></td>
    //                     <td>${res.email || 'N/A'}</td>
    //                     <td>${res.phone || 'N/A'}</td>
    //                     <td>${res.experience || 'N/A'}</td>
    //                     <td>Screening</td>
    //                     <td>Web Upload</td>
    //                     <td><span style="font-weight:800; color:${res.match_score >= 70 ? 'var(--secondary-color)' : 'var(--danger-color)'}">${res.match_score}%</span></td>
    //                     <td><span class="status-badge ${res.match_score >= 70 ? 'status-accepted' : 'status-rejected'}">${res.status}</span></td>
    //                 </tr>
    //             `).join('');

    //         } else {
    //             // --- DEEP SCAN (INDIVIDUAL) UI ---
    //             resultsBatch.style.display = 'none'; // Table hide karein
    //             results.style.display = 'block'; // Detail card show karein

    //             // Score aur UI update karna
    //             matchScore.textContent = (data.match_score || 0) + '%';
    //             progressFill.style.width = (data.match_score || 0) + '%';
    //             matchedSkills.innerHTML = (data.matched_skills || []).map(s => `<li><i class="fas fa-check"></i> ${s}</li>`).join('');
    //             missingSkills.innerHTML = (data.missing_skills || []).map(s => `<li><i class="fas fa-times"></i> ${s}</li>`).join('');
    //             suggestionsList.innerHTML = (data.suggestions || []).map(s => `<li><i class="fas fa-lightbulb"></i> ${s}</li>`).join('');

    //             // AAPKA PURANA LOGIC (Yeh User Portal ko update rakhega)
    //             updateUserDashboard(data, resumeFiles[0].name);
    //             updateHistory(resumeFiles[0].name, data.match_score);
    //         }

    //     } catch (error) {
    //         console.error("Error:", error);
    //         alert("Analysis failed. Please ensure the Python server is running.");
    //         loadingResults.style.display = 'none';
    //         uploadCard.style.display = 'block';
    //     }
    // });
  
}

            function renderBatchTable() {
                const tableBody = document.getElementById('batch-table-body');
                const candidates = [
                    { name: "Bilal Ahmad", email: "bilal.ahmad@example.com", phone: "+92 300 1234567", exp: "5 Years", stage: "Interview", source: "LinkedIn", score: 94 },
                    { name: "Sana Gul", email: "sana.gul@tech.io", phone: "+92 312 9876543", exp: "3 Years", stage: "Screening", source: "Indeed", score: 81 },
                    { name: "Hamza Sheikh", email: "hamza.sh@web.com", phone: "+92 345 5556667", exp: "1 Year", stage: "Rejected", source: "Referral", score: 45 },
                    { name: "Ayesha Malik", email: "ayesha.m@provider.pk", phone: "+92 321 0001112", exp: "4 Years", stage: "Technical Test", source: "Direct", score: 78 }
                ];
                tableBody.innerHTML = candidates.map(c => `<tr><td><strong>${c.name}</strong></td><td>${c.email}</td><td>${c.phone}</td><td>${c.exp}</td><td>${c.stage}</td><td>${c.source}</td><td><span style="font-weight:800; color:${c.score > 70 ? 'var(--secondary-color)' : 'var(--danger-color)'}">${c.score}%</span></td><td><span class="status-badge ${c.score > 70 ? 'status-accepted' : 'status-rejected'}">${c.score > 70 ? 'Accepted' : 'Rejected'}</span></td></tr>`).join('');
            }

            if (returnBtn) {
                returnBtn.addEventListener('click', () => {
                    document.body.classList.remove('results-view');
                    results.style.display = 'none';
                    resultsBatch.style.display = 'none';
                    analysisControls.style.display = 'none';
                    submissionForm.reset(); 
                    updateFileNameDisplay(null);
                    uploadCard.style.display = 'block';
                    uploadCard.scrollIntoView({ behavior: 'smooth' });
                });
            }
//////////////////////////
//           if (saveBtn) {
//     saveBtn.addEventListener('click', async () => {
//         // Result page se data uthana
//         const reportData = {
//             score: document.getElementById('match-score').innerText,
//             matched: Array.from(document.querySelectorAll('#matched-skills li')).map(li => li.innerText),
//             missing: Array.from(document.querySelectorAll('#missing-skills li')).map(li => li.innerText),
//             suggestions: Array.from(document.querySelectorAll('#suggestions-list li')).map(li => li.innerText)
//         };

//         try {
//             saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating Word File...';
            
//             const response = await fetch("http://127.0.0.1:8000/download-docx", {
//                 method: "POST",
//                 headers: { "Content-Type": "application/json" },
//                 body: JSON.stringify(reportData)
//             });

//             if (!response.ok) throw new Error("Download failed");

//             // Word file download process
//             const blob = await response.blob();
//             const url = window.URL.createObjectURL(blob);
//             const a = document.createElement('a');
//             a.href = url;
//             a.download = "Resume_Analysis_Report.docx";
//             document.body.appendChild(a);
//             a.click();
//             a.remove();
            
//             saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved to Laptop';
//             setTimeout(() => { saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Result'; }, 2000);

//         } catch (error) {
//             console.error("Error:", error);
//             alert("Could not save the Word file. Make sure Backend is running.");
//             saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Result';
//         }
//     });
// }
if (saveBtn) {
    saveBtn.addEventListener('click', async () => {
        let reportData = {};
        const isBatchActive = resultsBatch.style.display === 'block';

        if (isBatchActive) {
            // --- HR BATCH DATA COLLECT KAREIN ---
            const rows = Array.from(document.querySelectorAll('#batch-table-body tr'));
            const candidates = rows.map(row => {
                const cells = row.querySelectorAll('td');
                return {
                    name: cells[0].innerText,
                    email: cells[1].innerText,
                    phone: cells[2].innerText,
                    exp: cells[3].innerText,
                    score: cells[6].innerText,
                    status: cells[7].innerText
                };
            });

            reportData = {
                is_batch: true,
                candidates: candidates
            };
        } else {
            // --- SINGLE MODE DATA COLLECT KAREIN ---
            reportData = {
                is_batch: false,
                score: document.getElementById('match-score').innerText,
                matched: Array.from(document.querySelectorAll('#matched-skills li')).map(li => li.innerText),
                missing: Array.from(document.querySelectorAll('#missing-skills li')).map(li => li.innerText),
                suggestions: Array.from(document.querySelectorAll('#suggestions-list li')).map(li => li.innerText)
            };
        }

        try {
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating Report...';
            
            const response = await fetch("http://127.0.0.1:8000/download-docx", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(reportData)
            });

            if (!response.ok) throw new Error("Download failed");

            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = isBatchActive ? "HR_Batch_Report.docx" : "Candidate_Analysis_Report.docx";
            document.body.appendChild(a);
            a.click();
            a.remove();
            
            saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved!';
            setTimeout(() => { saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Result'; }, 2000);

        } catch (error) {
            console.error("Error:", error);
            alert("Could not save the report.");
            saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Result';
        }
    });
}


/////////////////////
            function updateHistory(jobTitle, score) {
                if (!historyList) return;
                const date = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                const newItem = document.createElement('div');
                newItem.className = 'resume-item';
                const scoreColor = score >= 80 ? 'var(--secondary-color)' : 'var(--warning-color)';
                newItem.innerHTML = `<div class="resume-info"><h4>${jobTitle}</h4><p>Analysed at ${date}</p></div><div class="resume-score" style="color: ${scoreColor};">${score}%</div>`;
                historyList.prepend(newItem);
            }

            // --- 9. Particle Background Animation ---
            const canvas = document.getElementById('particle-canvas');
            if (canvas) {
                const ctx = canvas.getContext('2d');
                let particles = [];
                const particleCount = 80;
                const maxDistance = 120;
                function getParticleColor() { return getComputedStyle(document.body).getPropertyValue('--particle-color').trim(); }
                function resizeCanvas() { canvas.width = canvas.parentElement.clientWidth; canvas.height = canvas.parentElement.clientHeight; }
                class Particle {
                    constructor() {
                        this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height; this.size = Math.random() * 3 + 1;
                        this.speedX = Math.random() * 1 - 0.5; this.speedY = Math.random() * 1 - 0.5; this.color = getParticleColor();
                    }
                    update() {
                        this.x += this.speedX; this.y += this.speedY;
                        if (this.x > canvas.width) this.x = 0; if (this.x < 0) this.x = canvas.width;
                        if (this.y > canvas.height) this.y = 0; if (this.y < 0) this.y = canvas.height;
                        this.draw();
                    }
                    draw() { ctx.fillStyle = getParticleColor(); ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); }
                }
                function createParticles() { particles = []; for (let i = 0; i < particleCount; i++) { particles.push(new Particle()); } }
                function connectParticles() {
                    const baseColor = getParticleColor(); 
                    const baseOpacityMatch = baseColor.match(/[\d.]+\)/);
                    const baseOpacity = baseOpacityMatch ? parseFloat(baseOpacityMatch[0].slice(0, -1)) : 0.25;
                    for (let a = 0; a < particles.length; a++) {
                        for (let b = a; b < particles.length; b++) {
                            const distance = Math.hypot(particles[a].x - particles[b].x, particles[a].y - particles[b].y);
                            if (distance < maxDistance) {
                                const opacity = 1 - (distance / maxDistance);
                                ctx.strokeStyle = baseColor.replace(/, [0-9.]+\)/, `, ${opacity * baseOpacity})`);
                                ctx.lineWidth = 0.5; ctx.beginPath(); ctx.moveTo(particles[a].x, particles[a].y); ctx.lineTo(particles[b].x, particles[b].y); ctx.stroke();
                            }
                        }
                    }
                }
                window.animateParticles = function() {
                    requestAnimationFrame(window.animateParticles);
                    const currentBg = getComputedStyle(document.body).getPropertyValue('--bg-color').trim();
                    ctx.fillStyle = currentBg === 'rgb(18, 18, 18)' ? 'rgba(18, 18, 18, 0.1)' : 'rgba(255, 255, 255, 0.1)';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    for (let i = 0; i < particles.length; i++) { particles[i].update(); }
                    connectParticles();
                }
                window.addEventListener('load', () => { resizeCanvas(); createParticles(); window.animateParticles(); });
                window.addEventListener('resize', resizeCanvas);
            }
            // setting page logic ////
            // --- GLOBAL SYNC FUNCTION (Crucial for Name Update) ---
function updateUIName(newName) {
    if (!newName) return;
    
    // Update global variables
    signedUpUserName = newName;

    // Update Dropdown Bold Name
    const dropdownH4 = document.querySelector('.profile-info h4');
    if (dropdownH4) dropdownH4.textContent = newName;

    // Update Dropdown Small Text
    const dropdownSpan = document.querySelector('.profile-info span');
    if (dropdownSpan) dropdownSpan.textContent = newName;

    // Update Headline in dropdown if you have one
    const headlineInput = document.getElementById('settings-headline');
    if(headlineInput && headlineInput.value) {
        // You can add a headline element in the dropdown to sync here
    }
}

// --- SETTINGS BUTTON LISTENERS ---

// 1. Apply Changes Button
document.getElementById('save-settings-btn').addEventListener('click', function() {
    const nameVal = document.getElementById('settings-name').value;
    
    // Run the UI sync
    updateUIName(nameVal);

    // Sync Theme
    const isDarkChecked = document.getElementById('settings-theme-toggle').checked;
    document.body.setAttribute('data-theme', isDarkChecked ? 'dark' : 'light');
    
    // Update Theme Icon in Navbar
    const themeIcon = document.querySelector('#theme-toggle i');
    if(themeIcon) {
        themeIcon.className = isDarkChecked ? 'fas fa-sun' : 'fas fa-moon';
    }

    // Button Animation Feedback
    this.innerHTML = '<i class="fas fa-check"></i> Applied Successfully';
    this.style.background = 'var(--secondary-color)';
    
    setTimeout(() => {
        this.innerHTML = '<i class="fas fa-save"></i> Apply Changes';
        this.style.background = 'var(--accent-color)';
    }, 2000);
});

// 2. Back Button
document.getElementById('close-settings-btn').addEventListener('click', () => {
    document.getElementById('settings-view').style.display = 'none';
    document.querySelector('.hero-section').style.display = 'block';
    document.querySelector('.container').style.display = 'grid';
});

// 3. Opening Settings
document.getElementById('settings-link').addEventListener('click', (e) => {
    e.preventDefault();
    if(typeof profileDropdown !== 'undefined') profileDropdown.style.display = 'none';
    
    document.querySelector('.hero-section').style.display = 'none';
    document.querySelector('.container').style.display = 'none';
    document.getElementById('settings-view').style.display = 'block';
    
    // Fill inputs with current data
    document.getElementById('settings-name').value = signedUpUserName || "";
    document.getElementById('settings-theme-toggle').checked = (document.body.getAttribute('data-theme') === 'dark');
});
////////////setting page logic end

////////////dashboard logic---
// --- DASHBOARD NAVIGATION LOGIC ---
const dashboardLink = document.getElementById('dashboard-link');
const dashboardView = document.getElementById('dashboard-view');
const backFromDashBtn = document.getElementById('back-from-dash');

// 1. Open Dashboard
dashboardLink.addEventListener('click', (e) => {
    e.preventDefault();
    
    // Hide Main Landing Components
    document.querySelector('.hero-section').style.display = 'none';
    document.querySelector('.container').style.display = 'none';
    if(document.getElementById('settings-view')) document.getElementById('settings-view').style.display = 'none';
    
    // Show Dashboard
    dashboardView.style.display = 'block';
    
    // Close Profile Dropdown
    if(typeof profileDropdown !== 'undefined') profileDropdown.style.display = 'none';
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
});

// 2. Return to Main Page (Back Button)
const returnToMain = () => {
    dashboardView.style.display = 'none';
    document.querySelector('.hero-section').style.display = 'block';
    document.querySelector('.container').style.display = 'grid';
};

backFromDashBtn.addEventListener('click', returnToMain);
///////////dashboard logic end
/////opening dasbboard logic////////////
// Update your dashboard-link event listener
dashboardLink.addEventListener('click', (e) => {
    e.preventDefault();
    
    // Hide ALL other main views
    document.querySelector('.hero-section').style.display = 'none';
    document.querySelector('.container').style.display = 'none';
    
    // ADD THIS LINE: Hide settings if it was open
    if(document.getElementById('settings-view')) {
        document.getElementById('settings-view').style.display = 'none';
    }
    
    // Show Dashboard
    dashboardView.style.display = 'block';
    
    if(typeof profileDropdown !== 'undefined') profileDropdown.style.display = 'none';
    window.scrollTo({ top: 0, behavior: 'smooth' });
});
////////////
////////opening setting logic//////////
// Update your settings-link event listener
document.getElementById('settings-link').addEventListener('click', (e) => {
    e.preventDefault();
    if(typeof profileDropdown !== 'undefined') profileDropdown.style.display = 'none';
    
    // Hide ALL other main views
    document.querySelector('.hero-section').style.display = 'none';
    document.querySelector('.container').style.display = 'none';
    
    // ADD THIS LINE: Hide dashboard if it was open
    if(document.getElementById('dashboard-view')) {
        document.getElementById('dashboard-view').style.display = 'none';
    }
    
    // Show Settings
    document.getElementById('settings-view').style.display = 'block';
    
    // Fill inputs...
    document.getElementById('settings-name').value = signedUpUserName || "";
});
//////////////////
////view switching logic////////////
const userDashboardLink = document.getElementById('user-dashboard-link');
const userDashboardView = document.getElementById('user-dashboard-view');

if (userDashboardLink && userDashboardView) {
    userDashboardLink.addEventListener('click', (e) => {
        e.preventDefault();

        // Close profile dropdown
        if (typeof profileDropdown !== 'undefined') {
            profileDropdown.style.display = 'none';
        }

        // Hide all other main sections
        document.querySelector('.hero-section').style.display = 'none';
        document.querySelector('.container').style.display = 'none';

        if (document.getElementById('settings-view')) {
            document.getElementById('settings-view').style.display = 'none';
        }

        if (document.getElementById('dashboard-view')) {
            document.getElementById('dashboard-view').style.display = 'none';
        }

        // Show USER dashboard
        userDashboardView.style.display = 'block';

        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
}
////////view switching end
////--helper hide functions--////////
// ===== FINAL FIX: ALWAYS HIDE USER DASHBOARD EXCEPT WHEN IT IS OPENED =====

// Function to force hide User Dashboard
function hideUserDashboard() {
    const userDash = document.getElementById('user-dashboard-view');
    if (userDash) {
        userDash.style.display = 'none';
    }
}

// When page loads, always hide User Dashboard
window.addEventListener('load', function () {
    hideUserDashboard();
});

// When opening Settings  hide User Dashboard
if (typeof settingsLink !== 'undefined') {
    settingsLink.addEventListener('click', function () {
        hideUserDashboard();
    });
}

// When opening ATS Dashboard  hide User Dashboard
if (typeof dashboardLink !== 'undefined') {
    dashboardLink.addEventListener('click', function () {
        hideUserDashboard();
    });
}

// When going back to Home (from any Back button)  hide User Dashboard
const allBackButtons = document.querySelectorAll('.back-btn, .close-btn');

allBackButtons.forEach(btn => {
    btn.addEventListener('click', function () {
        hideUserDashboard();
    });
});


////////////-----end---//////////

//////////////update _user_dashboard fucntion taake connect ho/////////////////
function updateUserDashboard(data, fileName) {
    // 1. Applied Jobs Counter Update
    appliedJobsCount++; 
    const appliedJobsElement = document.querySelector('#user-dashboard-view .stat-card:nth-child(2) h4');
    if (appliedJobsElement) {
        appliedJobsElement.textContent = appliedJobsCount;
    }

    // 2. Resume Health Score update
    const healthScoreElement = document.querySelector('#user-dashboard-view .stat-card h4');
    if (healthScoreElement) {
        healthScoreElement.textContent = `${data.match_score}/100`;
    }

    // 3. Skill Gaps update (Top 3)
    const skillGapContainer = document.querySelector('#user-dashboard-view .skill-card:first-child div[style*="background: rgba(0,0,0,0.03)"]');
    if (skillGapContainer && data.missing_skills) {
        skillGapContainer.innerHTML = data.missing_skills.slice(0, 3).map(skill => `
            <div style="margin-bottom: 10px;">
                <span style="font-size: 0.85rem;">${skill}</span>
                <div class="progress-bar" style="height: 8px;">
                    <div class="progress-fill" style="width: 25%; background: var(--danger-color);"></div>
                </div>
            </div>
        `).join('');
    }

    // 4. Recent Scans list update (Cleaning and Adding)
    const recentScansList = document.querySelector('#user-dashboard-view .skill-card:last-child');
    if (recentScansList) {
        // Agar pehli CV hai, toh purani hardcoded examples delete kar dein
        if (appliedJobsCount === 1) {
            const oldItems = recentScansList.querySelectorAll('.resume-item');
            oldItems.forEach(item => item.remove());
        }

        const scanItem = document.createElement('div');
        scanItem.className = 'resume-item';
        scanItem.style.marginBottom = '10px';
        const badgeClass = data.match_score >= 70 ? 'status-accepted' : 'status-rejected';
        
        scanItem.innerHTML = `
            <span>${fileName}</span>
            <span class="status-badge ${badgeClass}">${data.match_score}% Match</span>
        `;
        
        // Naye result ko sabse upar add karein
        recentScansList.insertBefore(scanItem, recentScansList.children[1]);
    }
}
////////////////end----//////////////////
        });
    </script>

    </body>
</html>